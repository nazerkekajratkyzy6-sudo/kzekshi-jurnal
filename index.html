<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–µ–∑–µ–∫—à—ñ –∂—É—Ä–Ω–∞–ª</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b3c5d">

<style>
:root{
  --blue:#0b3c5d;
  --blue2:#1d5f8a;
  --bg:#f4f7fb;
  --card:#ffffff;
  --border:#d9e2ec;
}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:var(--bg);
}
header{
  background:linear-gradient(135deg,var(--blue),var(--blue2));
  color:#fff;
  padding:16px;
  text-align:center;
  font-size:20px;
  font-weight:700;
}
header small{
  display:block;
  font-size:13px;
  opacity:.85;
}
.lang{
  position:absolute;
  right:12px;
  top:12px;
}
.lang button{
  background:rgba(255,255,255,.2);
  border:none;
  color:#fff;
  padding:4px 8px;
  border-radius:6px;
}
nav{
  display:flex;
  gap:8px;
  padding:12px;
}
nav button{
  flex:1;
  padding:14px;
  border:none;
  border-radius:14px;
  background:var(--blue);
  color:white;
  font-weight:600;
}
.page{display:none;padding:12px;}
.card{
  background:var(--card);
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
  border:1px solid var(--border);
}
select,input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
  margin-top:6px;
}
.student{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  padding:8px 0;
  border-bottom:1px solid var(--border);
}
textarea{
  width:100%;
  height:220px;
  border-radius:12px;
  border:1px solid var(--border);
  padding:10px;
}
.action{
  background:var(--blue);
  color:white;
  border:none;
  width:100%;
  padding:14px;
  border-radius:14px;
  margin-top:10px;
  font-weight:600;
}
.whatsapp{background:#128c7e;}
</style>
</head>

<body>

<header>
  üìò –ö–ï–ó–ï–ö–®–Ü –ñ–£–†–ù–ê–õ
  <small>"–®.–£”ô–ª–∏—Ö–∞–Ω–æ–≤ –∞—Ç—ã–Ω–¥–∞“ì—ã –æ—Ä—Ç–∞ –º–µ–∫—Ç–µ–±—ñ" –ö–ú–ú</small>
  <div class="lang">
    <button onclick="setLang('kk')">KZ</button>
    <button onclick="setLang('ru')">RU</button>
  </div>
</header>

<nav>
  <button onclick="show('mark')">–ö—ñ–º –∂–æ“õ</button>
  <button onclick="show('report')">–ï—Å–µ–ø</button>
  <button onclick="show('admin')">”ò–∫—ñ–º—à—ñ–ª—ñ–∫</button>
</nav>

<!-- –ö–Ü–ú –ñ–û“ö -->
<div id="mark" class="page">
  <div class="card">
    <b>–°—ã–Ω—ã–ø—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑</b>
    <select id="classSelect" onchange="renderStudents()"></select>
  </div>
  <div id="students"></div>
</div>

<!-- –ï–°–ï–ü -->
<div id="report" class="page">
  <div class="card">
    <b>–ö–µ–∑–µ“£</b>
    <input type="date" id="start">
    <input type="date" id="end">
    <button class="action" onclick="generateReport()">üìÑ –ï—Å–µ–ø –∞–ª—É</button>
    <button class="action whatsapp" onclick="sendWA()">WhatsApp</button>
  </div>
  <textarea id="out"></textarea>
</div>

<!-- ”ò–ö–Ü–ú–®–Ü–õ–Ü–ö -->
<div id="admin" class="page">
  <div class="card">
    <b>–ñ–∞–ª–ø—ã –µ—Å–µ–ø</b>
    <input type="date" id="astart">
    <input type="date" id="aend">
    <button class="action" onclick="adminReport()">üìä –°–≤–æ–¥–∫–∞</button>
  </div>
  <textarea id="aout"></textarea>
</div>

<script>
/* ===== GOOGLE SHEETS URL ===== */
const SHEET_URL="https://script.google.com/macros/s/AKfycbx5EBl-dNW0LG927bs8j_shMz2r7yezWzv6Dz6des-LGDqDBPmWG79YlAUHKz6_5UNs/exec";

/* ===== –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –ö–õ–ê–°–°–û–í (–ø—Ä–∏–º–µ—Ä, —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è) ===== */
const CLASSES={
"6 –ê":["–ê–±–¥—É—Ö–∞–∏–º–æ–≤ –ï–ª–Ω“±—Ä","–ê—Ä–º–∞–Ω“õ—ã–∑—ã –ê–π—ã–º","–ë–∞“ì–ª–∞–µ–≤ –ù“±—Ä–∏—Å–ª–∞–º","–ë–µ—Ä–¥—ñ–±–µ–∫“õ—ã–∑—ã ”ò–¥–µ–º—ñ","–î—É–ª–∞—Ç—Ö–∞–Ω“±–ª—ã –ù“±—Ä—Ö–∞–Ω","–ï—Ä–∑–∞—Ç –ù–∞—Ä–∏–º–∞–Ω"],
"6 ”ò":["–ê“õ–∞–Ω–æ–≤ –ï—Å—Ç–∞–π","–ë–∞“õ—ã—Ç–±–µ–∫ –ê–π—Ç–∞—Å","–ë–∞“õ—ã—Ç–±–µ–∫–æ–≤–∞ ”ò–¥–µ–º–∞–π","–ë–µ–∫–∂–∞–Ω“õ—ã–∑—ã “∞–ª–ø–∞–Ω","–ñ”ô–ª–µ–ª—Ö–∞–Ω –ï—Ä–∞—Å—ã–ª"],
"7 –ê":["–ê–¥—ã–ª—Ö–∞–Ω–æ–≤ –ê–ª–∏—Ö–∞–Ω","–ê–π–¥—ã–Ω –ê–π—Å–µ—Ä—ñ","–ê–º–∞–Ω–∂–æ–ª–æ–≤–∞ –ö”ô—É—Å–∞—Ä","–ê—Å–ª–∞–Ω“±–ª—ã –ï–ª–¥–æ—Å"],
"11 –ë":["–ê–¥—ã–ª—Ö–∞–Ω–æ–≤–∞ –ú”©–ª–¥—ñ—Ä","“ö–∞–ª–∏–±–µ–∫–æ–≤ –ï—Ä—Ö–∞—Ç","“ö–∞–Ω–∞—Ç–æ–≤–∞ –ï—Ä–∫–µ–º–∞–π","–ú“±—Ä–∞—Ç–±–µ–∫–æ–≤ –ê–π–±–µ–∫","–°–∞–≥–∏–¥–æ–ª–¥–∞ –ï—Ä–∞–ª—ã","–°—ã—Å–æ–µ–≤ –ê–ª–µ–∫—Å–µ–π"]
};

/* ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø ===== */
function show(id){
 document.querySelectorAll('.page').forEach(p=>p.style.display='none');
 document.getElementById(id).style.display='block';
}

/* ===== –ò–ù–ò–¶ ===== */
function init(){
 const sel=document.getElementById("classSelect");
 Object.keys(CLASSES).forEach(c=>sel.innerHTML+=`<option>${c}</option>`);
 renderStudents();
 show('mark');
}
document.addEventListener("DOMContentLoaded",init);

/* ===== –£–ß–ï–ù–ò–ö–ò ===== */
function renderStudents(){
 const cls=classSelect.value;
 const box=document.getElementById("students");
 box.innerHTML="";
 CLASSES[cls].forEach(s=>{
   box.innerHTML+=`
   <div class="card student">
     ${s}
     <select onchange="mark('${cls}','${s}',this.value)">
       <option>“ö–∞—Ç—ã—Å—ã–ø –æ—Ç—ã—Ä</option>
       <option>–°–µ–±–µ–ø—Å—ñ–∑</option>
       <option>–ê—É—ã—Ä—ã–ø “õ–∞–ª–¥—ã</option>
       <option>–°–µ–±–µ–ø—Ç—ñ</option>
       <option>–ë–∞—Å“õ–∞</option>
     </select>
   </div>`;
 });
}

/* ===== –ñ–ê–ó–£ ===== */
function mark(cls,student,reason){
 if(reason==="“ö–∞—Ç—ã—Å—ã–ø –æ—Ç—ã—Ä")return;
 const date=new Date().toISOString().slice(0,10);
 const body=new URLSearchParams({date,cls,student,reason});
 fetch(SHEET_URL,{method:"POST",body});
}

/* ===== –ï–°–ï–ü ===== */
async function generateReport(){
 const r=await fetch(`${SHEET_URL}?start=${start.value}&end=${end.value}`);
 const d=await r.json();
 let t=`üìå –ï—Å–µ–ø (${start.value} ‚Äì ${end.value})\n\n`;
 d.forEach(x=>t+=`‚Ä¢ ${x.class} ‚Äì ${x.student} (${x.date}: ${x.reason})\n`);
 out.value=t;
}

/* ===== WHATSAPP ===== */
function sendWA(){
 if(!out.value)return alert("–ï—Å–µ–ø –∂–æ“õ");
 window.open("https://wa.me/?text="+encodeURIComponent(out.value));
}

/* ===== ”ò–ö–Ü–ú–®–Ü–õ–Ü–ö ===== */
async function adminReport(){
 const r=await fetch(`${SHEET_URL}?start=${astart.value}&end=${aend.value}`);
 const d=await r.json();
 let t="üìä ”ò–∫—ñ–º—à—ñ–ª—ñ–∫–∫–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω –µ—Å–µ–ø\n\n";
 d.forEach(x=>t+=`‚Ä¢ ${x.class} ‚Äì ${x.student} (${x.date}: ${x.reason})\n`);
 aout.value=t;
}

function setLang(l){
 alert(l==="ru"?"–†—É—Å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω":"“ö–∞–∑–∞“õ—à–∞ —Ä–µ–∂–∏–º");
}
</script>

</body>
</html>
