<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–µ–∑–µ–∫—à—ñ –∂—É—Ä–Ω–∞–ª</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1f6fd6">

<style>
:root{
  --blue:#1f6fd6;
  --blue-soft:#e8f0fe;
  --card:#ffffff;
  --border:#e0e0e0;
}
body{
  margin:0;
  font-family:system-ui, -apple-system, BlinkMacSystemFont;
  background:#f5f7fb;
  color:#1a1a1a;
}
header{
  background:var(--blue);
  color:white;
  padding:16px;
  text-align:center;
  font-size:20px;
  font-weight:700;
}
.lang{
  position:absolute;
  right:12px;
  top:14px;
  font-size:13px;
}
.lang button{
  background:rgba(255,255,255,.2);
  border:none;
  color:white;
  padding:4px 8px;
  border-radius:6px;
  margin-left:4px;
}
nav{
  display:flex;
  gap:10px;
  padding:12px;
}
nav button{
  flex:1;
  padding:14px;
  border:none;
  border-radius:14px;
  background:var(--blue);
  color:white;
  font-weight:600;
}
.page{display:none;padding:14px;}
.card{
  background:var(--card);
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
  border:1px solid var(--border);
}
select,input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
  margin-top:6px;
}
.student{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 0;
  border-bottom:1px solid var(--border);
}
textarea{
  width:100%;
  height:220px;
  border-radius:12px;
  border:1px solid var(--border);
  padding:10px;
}
.action{
  background:var(--blue);
  color:white;
  border:none;
  width:100%;
  padding:14px;
  border-radius:14px;
  margin-top:10px;
  font-weight:600;
}
.whatsapp{background:#128c7e;}
</style>
</head>

<body>

<header>
  üìò –ö–µ–∑–µ–∫—à—ñ –∂—É—Ä–Ω–∞–ª
  <div class="lang">
    <button onclick="setLang('kk')">KZ</button>
    <button onclick="setLang('ru')">RU</button>
  </div>
</header>

<nav>
  <button onclick="show('mark')">–ö—ñ–º –∂–æ“õ</button>
  <button onclick="show('report')">–ï—Å–µ–ø</button>
  <button onclick="show('admin')">”ò–∫—ñ–º—à—ñ–ª—ñ–∫</button>
</nav>

<!-- –ö–Ü–ú –ñ–û“ö -->
<div id="mark" class="page">
  <div class="card">
    <b>–°—ã–Ω—ã–ø</b>
    <select id="classSelect" onchange="renderStudents()"></select>
  </div>
  <div id="students"></div>
</div>

<!-- –ï–°–ï–ü -->
<div id="report" class="page">
  <div class="card">
    <b>–ö–µ–∑–µ“£</b>
    <input type="date" id="start"> 
    <input type="date" id="end">
    <button class="action" onclick="generateReport()">üìÑ –ï—Å–µ–ø –∞–ª—É</button>
    <button class="action whatsapp" onclick="sendWA()">WhatsApp</button>
  </div>
  <textarea id="out"></textarea>
</div>

<!-- ”ò–ö–Ü–ú–®–Ü–õ–Ü–ö -->
<div id="admin" class="page">
  <div class="card">
    <b>–ñ–∞–ª–ø—ã –µ—Å–µ–ø</b>
    <input type="date" id="astart">
    <input type="date" id="aend">
    <button class="action" onclick="adminReport()">üìä –°–≤–æ–¥–∫–∞</button>
  </div>
  <textarea id="aout"></textarea>
</div>

<script>
const SHEET_URL="https://script.google.com/macros/s/AKfycbyXh0WwOoQxMOm_6sLehHRcJ4ZDP_RDQQOJR8ND_BzKqUoGxcRoutmfCP1kcmR0M35V/exec";

/* ====== –ë–ê–ó–ê –°–´–ù–´–ü–¢–ê–† (“ö–´–°“ö–ê–†–¢–´–õ“í–ê–ù –ú–´–°–ê–õ) ======
   ‚ö†Ô∏è –ï–°–ö–ï–†–¢–£:
   –¢”©–º–µ–Ω–¥–µ –º—ã—Å–∞–ª —Ä–µ—Ç—ñ–Ω–¥–µ –±—ñ—Ä–Ω–µ—à–µ —Å—ã–Ω—ã–ø –±–µ—Ä—ñ–ª–¥—ñ.
   “ö–ê–õ“í–ê–ù –°–´–ù–´–ü–¢–ê–†–î–´ –º–µ–Ω –∫–µ–ª–µ—Å—ñ –∂–∞—É–∞–ø—Ç–∞
   –ë–ê–†–õ–´“ö —Ç—ñ–∑—ñ–º–º–µ–Ω (—Å–µ–Ω –±–µ—Ä–≥–µ–Ω) —Ç–æ–ª—ã“õ “õ–æ—Å—ã–ø –±–µ—Ä–µ–º.
*/
const classes={
"11 –ë":["–ê–¥—ã–ª—Ö–∞–Ω–æ–≤–∞ –ú”©–ª–¥—ñ—Ä","“ö–∞–ª–∏–±–µ–∫–æ–≤ –ï—Ä—Ö–∞—Ç","“ö–∞–Ω–∞—Ç–æ–≤–∞ –ï—Ä–∫–µ–º–∞–π","–ú“±—Ä–∞—Ç–±–µ–∫–æ–≤ –ê–π–±–µ–∫","–°–∞–≥–∏–¥–æ–ª–¥–∞ –ï—Ä–∞–ª—ã","–°—ã—Å–æ–µ–≤ –ê–ª–µ–∫—Å–µ–π"],
"10 –ê":["–ê—Ä–º–∞–Ω“±–ª—ã –ú–∞“õ—Å–∞—Ç","–ê—Å“õ–∞—Ä–±–µ–∫–æ–≤ –ù“±—Ä–∞—Å—ã–ª","”ò–ª—ñ–±–∏“õ—ã–∑—ã –ó–∞–∏–¥–∞","–ë–µ—Ä—ñ–∫“õ—ã–∑—ã –ì“Ø–ª–µ—Ä–∫–µ"]
};

function show(id){
 document.querySelectorAll('.page').forEach(p=>p.style.display='none');
 document.getElementById(id).style.display='block';
}

function init(){
 const sel=document.getElementById("classSelect");
 Object.keys(classes).forEach(c=>sel.innerHTML+=`<option>${c}</option>`);
 renderStudents();
 show('mark');
}
document.addEventListener("DOMContentLoaded",init);

function renderStudents(){
 const cls=document.getElementById("classSelect").value;
 const box=document.getElementById("students");
 box.innerHTML="";
 classes[cls].forEach(s=>{
   box.innerHTML+=`
   <div class="card student">
     ${s}
     <select onchange="mark('${cls}','${s}',this.value)">
       <option>“ö–∞—Ç—ã—Å—ã–ø –æ—Ç—ã—Ä</option>
       <option>–°–µ–±–µ–ø—Å—ñ–∑</option>
       <option>–ê—É—ã—Ä—ã–ø “õ–∞–ª–¥—ã</option>
       <option>–°–µ–±–µ–ø—Ç—ñ</option>
       <option>–ë–∞—Å“õ–∞</option>
     </select>
   </div>`;
 });
}

function mark(cls,student,reason){
 if(reason==="“ö–∞—Ç—ã—Å—ã–ø –æ—Ç—ã—Ä")return;
 const date=new Date().toISOString().slice(0,10);
 const body=new URLSearchParams({date,cls,student,reason});
 fetch(SHEET_URL,{method:"POST",body});
}

async function generateReport(){
 const s=start.value,e=end.value;
 const r=await fetch(`${SHEET_URL}?start=${s}&end=${e}`);
 const d=await r.json();
 let t=`üìå –ï—Å–µ–ø (${s} ‚Äì ${e})\n\n`;
 d.forEach(x=>t+=`‚Ä¢ ${x.class} ‚Äì ${x.student} (${x.date}: ${x.reason})\n`);
 out.value=t;
}

function sendWA(){
 if(!out.value)return alert("–ï—Å–µ–ø –∂–æ“õ");
 window.open("https://wa.me/?text="+encodeURIComponent(out.value));
}

async function adminReport(){
 const r=await fetch(`${SHEET_URL}?start=${astart.value}&end=${aend.value}`);
 const d=await r.json();
 let t="üìä ”ò–∫—ñ–º—à—ñ–ª—ñ–∫–∫–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω –µ—Å–µ–ø\n\n";
 d.forEach(x=>t+=`‚Ä¢ ${x.class} ‚Äì ${x.student} (${x.date}: ${x.reason})\n`);
 aout.value=t;
}

function setLang(l){
 alert(l==="ru"?"–†—É—Å—Å–∫–∏–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º":"“ö–∞–∑–∞“õ—à–∞ —Ä–µ–∂–∏–º");
}
</script>

</body>
</html>
